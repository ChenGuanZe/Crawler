# 域名管理工具

<cite>
**本文档引用的文件**
- [DomainNameUtil.java](file://TigerTeeth/src/main/java/com/utils/DomainNameUtil.java)
- [DomainNameUtil.java](file://bettaFish/src/main/java/com/utils/DomainNameUtil.java)
- [DomainNameUtil.java](file://game-cnydh/src/main/java/com/utils/DomainNameUtil.java)
- [DomainNameUtil.java](file://game-lf/src/main/java/com/utils/DomainNameUtil.java)
- [DomainNameUtil.java](file://game-proxy/src/main/java/com/game/utils/DomainNameUtil.java)
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java)
- [GameProxyController.java](file://game-proxy/src/main/java/com/game/controller/GameProxyController.java)
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java)
- [DhsgService.java](file://game-proxy/src/main/java/com/game/douyu/dahsg/DhsgService.java)
- [BwhdSocketClient.java](file://game-proxy/src/main/java/com/game/gcbwz/BwhdSocketClient.java)
- [application.yml](file://game-proxy/src/main/resources/application.yml)
- [pom.xml](file://TigerTeeth/pom.xml)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [核心组件](#核心组件)
4. [架构概览](#架构概览)
5. [详细组件分析](#详细组件分析)
6. [依赖关系分析](#依赖关系分析)
7. [性能考虑](#性能考虑)
8. [故障排除指南](#故障排除指南)
9. [结论](#结论)

## 简介

域名管理工具是本项目中用于统一管理多个域名配置的核心组件。该工具通过静态常量数组的形式维护域名列表，为各个游戏模块提供统一的域名访问策略。主要功能包括：

- **域名列表管理**：集中维护多个域名配置
- **域名验证机制**：确保域名格式的有效性
- **域名选择策略**：支持轮询和随机选择等策略
- **多环境适配**：支持开发、测试、生产等不同环境的域名配置

## 项目结构

该项目采用多模块架构，每个游戏模块都有独立的DomainNameUtil工具类，但都遵循相同的命名约定和使用模式。

```mermaid
graph TB
subgraph "多模块架构"
TigerTeeth[TigerTeeth模块<br/>虎牙游戏]
BettaFish[bettaFish模块<br/>斗鱼游戏]
GameCNYDH[game-cnydh模块<br/>YO直播游戏]
GameLF[game-lf模块<br/>其他游戏]
GameProxy[game-proxy模块<br/>代理服务]
end
subgraph "域名管理工具"
DTUtil[DomainNameUtil<br/>通用工具类]
TTUtil[TigerTeeth专用]
BFUtil[BettaFish专用]
CNYDHUtil[game-cnydh专用]
LFUtil[game-lf专用]
GPUtil[game-proxy专用]
end
subgraph "使用模块"
YqlyyWs[YqlyyWsClient<br/>虎牙WebSocket客户端]
ProxyCtrl[GameProxyController<br/>代理控制器]
CnydhSvc[CnydhService<br/>YO直播服务]
DhsgSvc[DhsgService<br/>大话三国服务]
BwhdSock[BwhdSocketClient<br/>古城保卫战客户端]
end
TigerTeeth --> DTUtil
BettaFish --> DTUtil
GameCNYDH --> DTUtil
GameLF --> DTUtil
GameProxy --> DTUtil
DTUtil --> YqlyyWs
DTUtil --> ProxyCtrl
DTUtil --> CnydhSvc
DTUtil --> DhsgSvc
DTUtil --> BwhdSock
```

**图表来源**
- [DomainNameUtil.java](file://TigerTeeth/src/main/java/com/utils/DomainNameUtil.java#L1-L16)
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L102-L114)
- [GameProxyController.java](file://game-proxy/src/main/java/com/game/controller/GameProxyController.java#L395-L407)

**章节来源**
- [DomainNameUtil.java](file://TigerTeeth/src/main/java/com/utils/DomainNameUtil.java#L1-L16)
- [DomainNameUtil.java](file://game-proxy/src/main/java/com/game/utils/DomainNameUtil.java#L1-L16)

## 核心组件

### DomainNameUtil工具类设计

DomainNameUtil是一个静态工具类，采用final static修饰符定义域名数组，确保线程安全和不可变性。每个模块的工具类都遵循相同的设计模式，但包含不同的域名配置。

#### 基础架构设计

```mermaid
classDiagram
class DomainNameUtil {
<<工具类>>
+String[] urls
+String[] transitUrls
+String cnydh_room_game_url
+getUrls() String[]
+getTransitUrls() String[]
+getCnydhRoomGameUrl() String
}
class TigerTeethDomainUtil {
+urls : ["http : //127.0.0.1 : 8085"]
+transitUrls : ["http : //127.0.0.1 : 8085"]
}
class GameProxyDomainUtil {
+urls : ["http : //47.242.112.200/qmGame", "http : //8.210.135.202/qmGame"]
}
class GameCNYDHDomainUtil {
+transitUrls : ["http : //127.0.0.1 : 8085"]
+cnydh_room_game_url : "https : //hd-sports.yy.com/web/api/get_init_info?sid=..."
}
DomainNameUtil <|-- TigerTeethDomainUtil
DomainNameUtil <|-- GameProxyDomainUtil
DomainNameUtil <|-- GameCNYDHDomainUtil
```

**图表来源**
- [DomainNameUtil.java](file://TigerTeeth/src/main/java/com/utils/DomainNameUtil.java#L3-L15)
- [DomainNameUtil.java](file://game-proxy/src/main/java/com/game/utils/DomainNameUtil.java#L3-L15)
- [DomainNameUtil.java](file://game-cnydh/src/main/java/com/utils/DomainNameUtil.java#L3-L11)

#### 域名数组维护策略

每个模块根据其业务需求维护不同的域名数组：

1. **urls数组**：主要业务域名，用于正常的游戏数据交互
2. **transitUrls数组**：中转服务器域名，用于时间同步等特殊功能
3. **cnydh_room_game_url**：特定游戏的房间信息获取地址

**章节来源**
- [DomainNameUtil.java](file://TigerTeeth/src/main/java/com/utils/DomainNameUtil.java#L4-L13)
- [DomainNameUtil.java](file://game-proxy/src/main/java/com/game/utils/DomainNameUtil.java#L4-L12)
- [DomainNameUtil.java](file://game-cnydh/src/main/java/com/utils/DomainNameUtil.java#L5-L10)

## 架构概览

### 多域名管理架构

```mermaid
sequenceDiagram
participant Client as 客户端
participant DomainUtil as 域名管理器
participant GameService as 游戏服务
participant TargetServer as 目标服务器
Client->>DomainUtil : 获取域名列表
DomainUtil-->>Client : 返回urls数组
Client->>GameService : 执行业务操作
GameService->>DomainUtil : 遍历urls数组
loop 对每个域名执行操作
GameService->>TargetServer : 发送HTTP请求
TargetServer-->>GameService : 返回响应
GameService->>GameService : 记录日志
end
GameService-->>Client : 返回最终结果
```

**图表来源**
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L102-L114)
- [DhsgService.java](file://game-proxy/src/main/java/com/game/douyu/dahsg/DhsgService.java#L96-L105)

### 域名验证和选择机制

```mermaid
flowchart TD
Start([开始]) --> GetUrls["获取域名数组"]
GetUrls --> CheckEmpty{"数组为空?"}
CheckEmpty --> |是| ReturnError["返回错误"]
CheckEmpty --> |否| IterateUrls["遍历域名数组"]
IterateUrls --> ValidateUrl["验证域名格式"]
ValidateUrl --> UrlValid{"格式有效?"}
UrlValid --> |否| SkipUrl["跳过此域名"]
UrlValid --> |是| SendRequest["发送HTTP请求"]
SkipUrl --> NextUrl["处理下一个域名"]
SendRequest --> RequestSuccess{"请求成功?"}
RequestSuccess --> |是| ReturnSuccess["返回成功结果"]
RequestSuccess --> |否| HandleError["记录错误并继续"]
HandleError --> NextUrl
NextUrl --> MoreUrls{"还有域名?"}
MoreUrls --> |是| ValidateUrl
MoreUrls --> |否| ReturnFailure["返回失败结果"]
ReturnError --> End([结束])
ReturnSuccess --> End
ReturnFailure --> End
```

**图表来源**
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L103-L114)
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java#L113-L123)

**章节来源**
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L102-L114)
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java#L113-L123)

## 详细组件分析

### 虎牙游戏模块（TigerTeeth）

#### 域名配置特点

虎牙游戏模块采用了最完整的域名配置方案，包含本地开发环境和生产环境的双重配置：

```mermaid
graph LR
subgraph "虎牙游戏域名配置"
LocalDev["本地开发<br/>http://127.0.0.1:8085"]
Production["生产环境<br/>多个备用域名"]
end
subgraph "使用场景"
LotterySync["开奖结果同步"]
TimeSync["游戏时间同步"]
WebSocket["WebSocket连接"]
end
LocalDev --> LotterySync
LocalDev --> TimeSync
Production --> LotterySync
Production --> WebSocket
```

**图表来源**
- [DomainNameUtil.java](file://TigerTeeth/src/main/java/com/utils/DomainNameUtil.java#L4-L13)
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L102-L114)

#### 核心使用流程

虎牙游戏模块展示了域名管理工具的最佳实践：

1. **多域名遍历**：对urls数组中的每个域名执行相同的操作
2. **异常处理**：每个域名请求都有独立的异常处理机制
3. **日志记录**：详细的日志记录便于问题排查
4. **资源清理**：及时关闭连接和清理资源

**章节来源**
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L102-L114)
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L136-L147)

### 代理服务模块（game-proxy）

#### 域名配置策略

代理服务模块专注于提供稳定的代理服务，域名配置相对简洁：

```mermaid
graph TB
subgraph "代理服务域名配置"
MainDomain["主域名<br/>http://47.242.112.200/qmGame"]
BackupDomain["备用域名<br/>http://8.210.135.202/qmGame"]
end
subgraph "服务功能"
LotterySync["开奖结果同步"]
WebSocket["WebSocket服务"]
GameData["游戏数据处理"]
end
MainDomain --> LotterySync
MainDomain --> WebSocket
MainDomain --> GameData
BackupDomain --> LotterySync
BackupDomain --> WebSocket
BackupDomain --> GameData
```

**图表来源**
- [DomainNameUtil.java](file://game-proxy/src/main/java/com/game/utils/DomainNameUtil.java#L4-L12)
- [GameProxyController.java](file://game-proxy/src/main/java/com/game/controller/GameProxyController.java#L395-L407)

#### API接口集成

代理服务模块提供了完整的API接口来处理各种游戏的开奖结果同步：

**章节来源**
- [GameProxyController.java](file://game-proxy/src/main/java/com/game/controller/GameProxyController.java#L395-L407)
- [DhsgService.java](file://game-proxy/src/main/java/com/game/douyu/dahsg/DhsgService.java#L96-L105)

### YO直播模块（game-cnydh）

#### 特殊域名配置

YO直播模块采用了独特的域名配置方式，包含了专门的房间信息获取URL：

```mermaid
graph LR
subgraph "YO直播域名配置"
TransitServer["中转服务器<br/>http://127.0.0.1:8085"]
RoomInfo["房间信息URL<br/>https://hd-sports.yy.com/..."]
end
subgraph "业务流程"
TimeSync["游戏时间同步"]
RoomInfoFetch["房间信息获取"]
LotteryResult["开奖结果处理"]
end
TransitServer --> TimeSync
TransitServer --> RoomInfoFetch
RoomInfo --> RoomInfoFetch
RoomInfoFetch --> LotteryResult
```

**图表来源**
- [DomainNameUtil.java](file://game-cnydh/src/main/java/com/utils/DomainNameUtil.java#L5-L10)
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java#L101-L123)

**章节来源**
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java#L55-L65)
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java#L113-L123)

### 其他模块对比分析

#### bettaFish模块

bettaFish模块的DomainNameUtil相对简单，主要用于注释说明：

```mermaid
graph TB
subgraph "bettaFish模块"
CommentedUrls["注释的域名配置"]
CurrentEmpty["当前为空"]
end
subgraph "使用状态"
NotUsed["未实际使用"]
Planned["计划使用"]
end
CommentedUrls --> Planned
CurrentEmpty --> NotUsed
```

**图表来源**
- [DomainNameUtil.java](file://bettaFish/src/main/java/com/utils/DomainNameUtil.java#L4-L8)

#### game-lf模块

game-lf模块专注于中转服务器配置：

**章节来源**
- [DomainNameUtil.java](file://game-lf/src/main/java/com/utils/DomainNameUtil.java#L5-L7)

## 依赖关系分析

### 模块间依赖关系

```mermaid
graph TB
subgraph "核心依赖"
DomainUtil[DomainNameUtil工具类]
HttpComponents[Apache HttpClient]
WebSocket[WebSocket客户端]
Logging[日志系统]
end
subgraph "使用模块"
TigerTeeth[TigerTeeth模块]
GameProxy[GameProxy模块]
GameCNYDH[GameCNYDH模块]
GameLF[GameLF模块]
BettaFish[BettaFish模块]
end
subgraph "第三方库"
SpringBoot[Spring Boot]
Netty[Netty]
Hutool[Hutool工具包]
end
DomainUtil --> HttpComponents
DomainUtil --> WebSocket
DomainUtil --> Logging
TigerTeeth --> DomainUtil
GameProxy --> DomainUtil
GameCNYDH --> DomainUtil
GameLF --> DomainUtil
BettaFish --> DomainUtil
HttpComponents --> SpringBoot
WebSocket --> Netty
Logging --> Hutool
TigerTeeth --> SpringBoot
GameProxy --> SpringBoot
GameCNYDH --> SpringBoot
GameLF --> SpringBoot
BettaFish --> SpringBoot
```

**图表来源**
- [pom.xml](file://TigerTeeth/pom.xml#L26-L111)
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L102-L114)

### 依赖注入和配置管理

每个模块都通过Spring Boot框架进行依赖注入和配置管理：

**章节来源**
- [pom.xml](file://TigerTeeth/pom.xml#L1-L160)

## 性能考虑

### 域名访问优化策略

1. **并发处理**：多个域名可以并行访问，提高整体响应速度
2. **异常隔离**：单个域名失败不影响其他域名的处理
3. **资源复用**：HTTP连接和WebSocket连接的合理复用
4. **缓存策略**：域名配置的缓存避免重复解析

### 性能监控指标

```mermaid
graph LR
subgraph "性能监控"
ResponseTime["响应时间"]
SuccessRate["成功率"]
ErrorCount["错误计数"]
RetryCount["重试次数"]
end
subgraph "优化目标"
MinResponse["最小化响应时间"]
MaxSuccess["最大化成功率"]
MinErrors["最小化错误数"]
MinRetries["最小化重试次数"]
end
ResponseTime --> MinResponse
SuccessRate --> MaxSuccess
ErrorCount --> MinErrors
RetryCount --> MinRetries
```

## 故障排除指南

### 常见问题及解决方案

#### 域名访问失败

**问题现象**：
- HTTP请求超时
- 连接被拒绝
- DNS解析失败

**排查步骤**：
1. 检查域名格式是否正确
2. 验证网络连通性
3. 确认目标服务器状态
4. 查看防火墙设置

**解决方案**：
- 使用备用域名替换
- 实施重试机制
- 添加健康检查
- 记录详细的错误日志

#### 异常处理最佳实践

```mermaid
flowchart TD
RequestStart[请求开始] --> ValidateDomain["验证域名"]
ValidateDomain --> DomainValid{域名有效?}
DomainValid --> |否| LogInvalid["记录无效域名"]
DomainValid --> |是| SendRequest["发送请求"]
SendRequest --> RequestComplete{请求完成?}
RequestComplete --> |是| CheckResponse["检查响应"]
RequestComplete --> |否| HandleNetworkError["处理网络错误"]
CheckResponse --> ResponseOK{响应成功?}
ResponseOK --> |是| Success["处理成功响应"]
ResponseOK --> |否| HandleHttpError["处理HTTP错误"]
HandleNetworkError --> RetryLogic["重试逻辑"]
HandleHttpError --> RetryLogic
RetryLogic --> NeedRetry{需要重试?}
NeedRetry --> |是| ValidateDomain
NeedRetry --> |否| LogError["记录最终错误"]
LogInvalid --> End[结束]
Success --> End
LogError --> End
```

**图表来源**
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L109-L113)

**章节来源**
- [GameYqlyyWsClient.java](file://TigerTeeth/src/main/java/com/yqlyy/GameYqlyyWsClient.java#L109-L113)
- [CnydhService.java](file://game-cnydh/src/main/java/com/cnydh/cnydh/CnydhService.java#L118-L122)

### 日志记录和调试

建议在域名管理中实施以下日志记录策略：

1. **成功日志**：记录域名访问的成功响应
2. **失败日志**：记录域名访问的失败原因
3. **性能日志**：记录响应时间和处理时长
4. **异常日志**：记录异常堆栈和上下文信息

## 结论

域名管理工具作为本项目的核心基础设施，通过统一的域名配置管理和多域名访问策略，为各个游戏模块提供了稳定可靠的服务支持。主要优势包括：

1. **统一管理**：集中管理所有域名配置，便于维护和更新
2. **高可用性**：多域名备份机制确保服务的连续性
3. **灵活扩展**：支持不同模块的特殊需求和配置要求
4. **易于维护**：清晰的代码结构和完善的注释说明

通过合理的域名配置策略和异常处理机制，该工具能够有效提升系统的稳定性和可靠性，在多域名环境下提供优质的用户体验。

建议在未来的发展中：
- 继续完善域名健康检查机制
- 增加动态域名配置更新功能
- 优化域名选择算法以适应不同的业务场景
- 加强监控和告警机制的建设